Resources:

  sslSecurityGroupIngress: 

    Type: AWS::EC2::SecurityGroupIngress

    Properties:

      GroupId: {"Fn::GetAtt" : ["AWSEBSecurityGroup", "GroupId"]}

      IpProtocol: tcp

      ToPort: 443

      FromPort: 443

      CidrIp: 0.0.0.0/0

      

commands:

  00_getSSLcertificate: 

    command: | 

      sudo service httpd stop

      mkdir -p /opt/certbot

      wget https://dl.eff.org/certbot-auto -O /opt/certbot/certbot-auto;chmod a+x /opt/certbot/certbot-auto

      sudo mkdir -p /var/www/challenge

      sudo /opt/certbot/certbot-auto certonly --debug --non-interactive --email srinivasandhandapani071201@gmail.com --agree-tos --standalone --domains api.royall.in --keep-until-expiring -w /var/www/challenge

  10_renewSSLCertificate:

    command: '(crontab -l ; echo ''0 6 * * * root /opt/certbot/certbot-auto renew --standalone --pre-hook "service httpd stop" --post-hook "service httpd start" --force-renew'') | crontab -'